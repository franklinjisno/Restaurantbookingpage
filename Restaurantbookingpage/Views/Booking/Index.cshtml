@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 style="text-align:center"><b>Restaurant Booking</b></h2>

<p><button type="button" class="btn btn-info btn-check" onclick="createbooking()">Create New</button></p>

<table class="table table-borderless" style="text-align:center" id="BookingTable">
    <thead>
        <tr class="headercolour">
            <th>
                Cutomer Name
            </th>
            <th>
                Date of Booking
            </th>
            <th>
                Dinning Type
            </th>
            <th>
                Number of Guest
            </th>
            <th>
                Contact
            </th>
            <th>
                Category
            </th>
            <th>Action</th>
        </tr>
    </thead>

</table>

<div class="modal fade" id="bookingmodal" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document" style="padding-left:50px">
        <div class="modal-content" id="bookingmodalbody" style="width: 90%">

        </div>

    </div>
</div>

<div class="modal fade" id="bookingmodal1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document" style="padding-left:160px">
        <div class="modal-content" id="bookingmodalbody1" style="width: 60%">

        </div>

    </div>
</div>

<script>
    var dataTable;
    $(document).ready(function () {

        dataTable = $('#BookingTable').DataTable(

            {
                "processing": true,
                "serverSide": true,
                "filter": true,
                "bInfo": false,
                "order": [0, "asc"],
                "columnDefs": [
                    { "targets": [1], orderable: false },
                    { "targets": [4], orderable: false },
                    { "targets": [6], orderable: false }
                ],

                "ajax": {

                    url: "/Booking/BookingData",

                    type: "POST",

                    datatype: "json"

                },

                columns: [

                    { "data": "Customer_Name" },

                    {
                        "data": "Datetime",
                        "type": "shortdatetime",
                        "render": function (value) {
                            if (value === null) return "";
                            var pattern = /Date\(([^)]+)\)/;
                            var results = pattern.exec(value);
                            var dt = new Date(parseFloat(results[1]));
                            return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear()
                        }
                    },

                    { "data": "Dinning_Type" },

                    { "data": "NumberofGuest" },

                    { "data": "Contact" },

                    { "data": "Category" },

                    {
                        "data": "Id",
                        "render": function (booking) {
                            return ('<button id="viewclick" class"btn btn-success" onclick="getDetails(' + booking + ')">View</button> <button id="editclicks" class"btn btn-success" onclick="getEditDetails(' + booking + ')">Edit</button> <button class"btn btn-success" onclick="getDelete(' + booking + ')">Delete</button>');
                        }

                    }]
                
           
            });
    });

    function createbooking() {
        $.get("/Booking/Create", { operation: "Create" }, function (res) {
            $("#bookingmodalbody").html(res);
            $("#bookingmodal").modal('show');
            $('#editclick').prop('disabled', 'true');
        })
    }

    function Savebooking() {
        var modal = $("#bookingmodal");
        var form = $('form[name="bookingForm"]');
        form.validate();
        if (!form.valid()) {
            return;
        } else {
            var data = form.serialize();
            $.post("/Booking/CreateEdit", data, function (res) {
                if (res) {
                    Swal.fire({
                        position: 'top-centre',
                        icon: 'success',
                        title: 'Booking saved',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    modal.modal('hide');
                    dataTable.ajax.reload();
                }
            })
        }
    }

    function getDetails(id) {
        $.get("/Booking/View", { operation: "View" , id: id }, function (res) {
            $('#bookingmodalbody').html(res);
            $('#bookingmodal').modal('show');
            $('#saveclick').prop('disabled', 'true');
        })
    }

    function getEditDetails(id) {
        $.get("/Booking/Edit", { operation: "Edit", id: id }, function (res) {
            $('#bookingmodalbody').html(res);
            $('#bookingmodal').modal('show');
            $('#editclick').prop('disabled', 'true');
        })
    }

    function getDelete(id) {
        $.get("/Booking/DeletePartial", { operation: "Delete" , id: id }, function (res) {
            $('#bookingmodalbody1').html(res);
            $('#bookingmodal1').modal('show');
        })
    }

    function Deletebooking(id) {
            var modal = $("#bookingmodal1");
            var form = $('form[name="bookingdeleteForm"]');
            form.validate();
            if (!form.valid()) {
                return;
            } else {
                var data = form.serialize();
                $.post("/Booking/Delete", data, function (res) {
                    if (res) {
                        Swal.fire({
                            position: 'top-centre',
                            icon: 'success',
                            title: 'Booking Deleted',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        modal.modal('hide');
                        dataTable.ajax.reload();
                    }
                })
            }
    }
</script>
